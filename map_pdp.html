<!DOCTYPE html>
<meta charset="utf-8">
<head>
<title>MGNREGA Public Data Portal</title>
</head>

<style>

body {
	background-color: white;
	vertical-align:baseline;
	line-height:normal;
	padding:0;
	margin:0;
	background-color:rgb(250,250,250);
	height:100%;

}

#main {
	width:960px;
    position:relative;
    margin-left:auto;
    margin-right:auto;
    margin-top:30px;
    margin-bottom:50px;
}

#footer {
	width:100%;
	box-shadow: 0 5px 8px -5px hsla(0, 0%, 0%, 0.3);
	left:0;
	background-image:url('images/sos.png');
	z-index:100;
	height:150px;
	margin:0;
	padding:0;
}

#topContainer {
	width:100%;
	box-shadow: 0 5px 8px -5px hsla(0, 0%, 0%, 0.3);
	top:0;
	left:0;
	background-image:url('images/sos.png');
	z-index:100;
	height:120px;
	margin:0;
	padding:0;
}
#top {
    width: 960px;
    margin-left:auto;
    margin-right:auto;
    position: relative;
    margin-top:0;
    padding:0;
    background-color:white;
}
#titleText1 {
    background-color:none;
    font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif; 
    font-size: 26px;
    color: rgb(80,80,80);
    text-align:left;
    margin-bottom:0px;
    font-weight:300;
    margin-top:24px;
	display:block;
	margin-left:25px;
	line-height:.9;
	padding:0;
}
#titleText2 {
    background-color:none;
    font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif; 
    font-size: 44px;
    color: rgb(50,50,50);
    text-align:left;
    margin-bottom:0px;
    font-weight:300;
    margin-top:8px;
	display:block;
	margin-left:25px;
	line-height:.9;
	padding:0;
}
#brush {
	position:absolute;
	margin-top:26px;
	margin-left:165px;
}
#saffron {
	height:2px;
	width:147px;
	margin-top:38px;
	margin-left:170px;
	position:absolute;
	background-color: #ffb33b;
	display:none;

}
#white {
	height:2px;
	width:80px;
	position:absolute;
	margin-top:37px;
	margin-left:190px;
	background-color: white;
	display:none;
}
#green {
	height:2px;
	width:147px;
	position:absolute;
	margin-top:45px;
	margin-left:215px;
	background-color:#5baf6a;
	display:none;
}

h1 {
	-webkit-margin-after: 0px;
	-webkit-margin-before:0px;
	display:inline;
}

#linkNav {
    font-family: Arial, sans-serif; 
    font-weight: normal;
    font-size: 14px;
    float:right;
    margin-top:33px;

}


.navItem {
	margin-left:10px;
	text-decoration: none;
	color: rgb(230,230,230);
	background-color:rgb(100,100,100);
	padding:5px 12px 5px 12px;
	font-weight:normal;
    border-radius:3px;
}

.navItem:hover {
	background-color:rgb(130,130,130);
}

.navItem:active {
	background-color:rgb(115,115,115);
}
#ashoka {
	float:left;
	margin-top:21px;
	width:50px;
	height:89px;
}
#textcontainer {
	float:left;
}

#epod {
	margin-top:69px;
	position:absolute;
	margin-left:802px;
	display:block;
}
#mord {
	display:block;
	margin-top:68px;
	margin-left:637px;
	position:absolute;
}
#bottom {
    width: 960px;
    margin-left:auto;
    margin-right:auto;
    position: relative;
    margin-top:0;
    padding:0;
    background-color:transparent;
}
#developedby {
	font-weight:normal; font-family: Helvetica, Arial, sans-serif; font-size: 14px;
	background-color: transparent;
	display:block;
	float:left;
	margin-top:30px;
	line-height:1.4;
	width:450px;
	margin-left:50px;
}

#dfidcontainer {
	font-weight:normal; font-family: Helvetica, Arial, sans-serif; font-size: 14px;
	background-color: transparent;
	display:block;
	float:right;
	margin-top:30px;
}
#dfidlogo {
	display:block;
	margin-top:0px;
}
#niclogo 
{
    display:block;
    margin-top:30px;
    float:left;
}

#tooltipDiv {
	color: black;
	position:absolute;
	pointer-events:none; 
	cursor:default; 
	background-color:white;
	font-size:12px;
	font-family:Arial, Helvetica, sans-serif;
	padding: 5px 7px 4px 7px;
	z-index: 9999;
	display: none;
	line-height:140%;
	box-shadow: 0 2px 8px hsla(0, 0%, 0%, 0.3);
}
#chartcontainer {
	box-shadow: 0 2px 8px hsla(0, 0%, 0%, 0.3);
	width:960px;
	height:515px;
	position:relative;
	margin-left:auto;
	margin-right:auto;
	margin-top:30px;
}
#chart1 {
	width:715px;
	height:515px;
	/*margin-left:240px;*/
	float:left;
	border-left:1px solid rgb(200,200,200);
}
#chartcontrol {
	float:left;
	width:240px;
	height:515px;
}
#controltitle {
	position:absolute;
	margin-left:20px;
	margin-top:30px;
	font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif; 
	font-size: 20px;
	font-weight:normal;
}
#indicTitle {
	position:absolute;
	margin-left:20px;
	margin-top:75px;
	font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif; 
	font-size: 14px;
	font-weight:bold
}
#indicMenu {
	position:absolute;
	margin-top:100px;
	margin-left:20px;
	width:181px;

}
#yearTitle {
	position:absolute;
	margin-left:20px;
	margin-top:140px;
	font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif; 
	font-size: 14px;
	font-weight:bold
}
#yearMenu {
	position:absolute;
    margin-top:165px;
    margin-left:20px;
}

#bluestrip {
	height:25px;
	/*border-bottom: 1px solid rgb(200,200,200);*/
	background-color: #3c68b9;
	/*background-image:url('images/sos.png')*/
	border-radius: 4px 4px 0px 0px;
	display:none;
}
	
#hoverLabel1 {
    position:absolute;
    font-size:10px;
    font-weight: bold;
    font-family:Arial, Helvetica, sans-serif;
    margin-left:30px;
    margin-top:220px;
    color:rgb(80,80,80);
    pointer-events:none;
}
#hoverLabel2 {
    position:absolute;
    font-size:10px;
    font-weight: bold;
    font-family:Arial, Helvetica, sans-serif;
    margin-left:30px;
    margin-top:260px;
    color:rgb(80,80,80);
    pointer-events:none;
}
#raquo1 {
    position:absolute;
    font-size:10px;
    font-weight: bold;
    font-family:Arial, Helvetica, sans-serif;
    margin-left:20px;
    margin-top:220px;
    color:rgb(80,80,80);
    pointer-events:none;
}
#raquo2 {
    position:absolute;
    font-size:10px;
    font-weight: bold;
    font-family:Arial, Helvetica, sans-serif;
    margin-left:20px;
    margin-top:260px;
    color:rgb(80,80,80);
    pointer-events:none;
}

#tipline {
    background-color:rgb(150,150,150);
    height:1px;
    width:200px;
    margin-top:5px;
}

#dlLinks {
    position: absolute;
    font-family: Arial, sans-serif;
    font-size:11px;
    top:455px;
    left: 755px;
}
#dlCSV {
    margin-right:10px;
    text-decoration: underline;
    cursor: pointer;
}
#dlChart {
    text-decoration: underline;
    cursor:pointer;
}
#ranktext {
    margin-top:5px;
    font-size:12px;
}
.vizItem {
    margin-right:30px;
}

#vizNav {
    margin-top:30px;
    font-family: Helvetica Neue, Arial;
    font-weight: normal;
    font-size: 14px;
    font-style:italic;

}

form {
    font-family: Helvetica Neue, Arial;
    font-weight: normal;
    font-size: 14px;
}
#chrome {
    float:right;
    font-family: Helvetica Neue, Arial;
    font-weight: normal;
    font-size: 16px;
    font-style:normal;
}

#overlay {
    background-color:rgba(150,150,150,.5);
    position:absolute;
    width:100%;
    height:820px;
    display:none;
    top:0px;
    left:0px;
}
#titleText99 {
    background-color:none;
    font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif; 
    font-size: 11px;
    color: rgb(50,50,50);
    margin-bottom:0px;
    font-weight:300;
    margin-top:1px;
    display:block;
    margin-left:25px;
    padding:0;

}

</style>
</head>
<body>
<script src="libraries/d3.v3.min.js"></script>
<script src="libraries/topojson.v1.min.js"></script>
<script src="libraries/queue.v1.min.js"></script>
<script src="libraries/jquery-1.8.3.min.js"></script>
<script src="libraries/rgbcolor.js"></script> 
<script src="libraries/canvg.js"></script>
<script src="libraries/svgenie.js"></script>
<div id="topContainer">
<div id="top">
	<div id = "ashoka"><img src = "images/Emblem_of_India.png" height="85px"></div>
	<div id = "textcontainer">
	<div id="saffron"></div><div id="white"></div><div id="green"></div>
	<img id="brush" src="images/brush_125.png" />
    <h1 id="titleText1">MGNREGA</h1><h1 id="titleText2">Public Data Portal</h1>
    <h1 id="titleText99"> &nbsp;Beta Version</h1>
    </div>
    <span id="linkNav">
        <a href="http://nrega.nic.in/netnrega/home.aspx" class="navItem">MGNREGA Home</a><a href="http://nrega.nic.in/NregaOfficial.htm" class="navItem">Contact</a>
    </span>
    <a href="rural.nic.in" id="mord"><img src="images/mord-nrega-34-fullname.png"></a>
    <a href="http://www.hks.harvard.edu/centers/cid/programs/evidence-for-policy-design" id="epod"><img src="images/evidence-for-policy-design-mod.png"></a>
</div>
</div>
<div id="main">
	<div id="vizNav">
        <a class="vizItem">Map</a><a href="trend_pdp.html" class="vizItem">Time trend</a>
        <span id="chrome">&raquo; Works best in <b>Google Chrome</b></span>
    </div>
    <div id="chartcontainer">
    	<div id="chartcontrol">
	    	<div id="controltitle">Mapping MGNREGA</div>
	    	<form autocomplete="off">
	    		<div id="indicTitle">Select indicator</div>
	            <select id="indicMenu"><option>Percent female person-days</option><option>Percent SC person-days</option><option>Percent ST person-days</option><option>Average wage</option>
	            </select>
	            <div id="yearTitle">Select year</div>
	            <select id="yearMenu"><option>2013-2014</option><option selected="true">2012-2013</option></select>
	        </form>
	        <div id="raquo1">&raquo;</div>
	        <div id="raquo2">&raquo;</div>
	        <div id="hoverLabel1">Hover over a region<br>for more info</div>
	        <div id="hoverLabel2">Single-click a state<br>to zoom in</div>
	    </div>
    	<div id="chart1">
        	<div id="dlLinks"><span id="dlCSV">Download .csv</span><span id="dlChart">Download chart</span></div>
		</div>
    </div>
</div>
<div id="tooltipDiv"><div id="tiptext"></div><div id="tipline"></div><div id="ranktext"></div></div>
<div id="overlay"></div>
<div id="footer">
    <div id="bottom"> 
        <div id="niclogo"><a href="http://www.nic.in/"><img src="images/nic.png"></a></div>
        <div id="developedby">Site designed and developed by National Informatics Center and Evidence for Policy Design at Harvard University.
        </div>
        <div id="dfidcontainer">Made possible with support from: 
            <div id="dfidlogo"><a href="https://www.gov.uk/government/organisations/department-for-international-development"><img src="images/dfid-logo-wide-55.png"></a></div>
        </div>
    </div>
</div>
</body>

<script>

queue()
    .defer(d3.json, "maps/states-cens01-topo.json")
    .defer(d3.json, "maps/districts-cens01-topo-10.json")
    .defer(d3.csv, "data/state_misindics1213_ccodes.csv")
    .defer(d3.csv, "data/dist_misindics1213_forshp2001.csv")
    .await(ready);

function ready(error, states_cens, districts_cens, states_indicators, districts_indicators) {

    chart(states_cens, districts_cens, states_indicators, districts_indicators);

}

function chart(states_cens, districts_cens, states_indicators, districts_indicators) {

    var stateNames = {35: "Andaman and Nicobar", 28: "Andhra Pradesh", 12: "Arunachal Pradesh", 18: "Assam", 10: "Bihar", 4: "Chandigarh", 22: "Chhattisgarh", 26: "Dadra and Nagar Haveli", 25: "Daman and Diu", 7: "Delhi", 30: "Goa", 24: "Gujarat", 6: "Haryana", 2: "Himachal Pradesh", 1: "Jammu and Kashmir", 20: "Jharkhand", 29: "Karnataka", 32: "Kerala", 31: "Lakshadweep", 23: "Madhya Pradesh", 27: "Maharashtra", 14: "Manipur", 17: "Meghalaya", 15: "Mizoram", 13: "Nagaland", 21: "Odisha", 34: "Puducherry", 3: "Punjab", 8: "Rajasthan", 11: "Sikkim", 33: "Tamil Nadu", 16: "Tripura", 9: "Uttar Pradesh", 5: "Uttaranchal", 19: "West Bengal"},
    districtNames = {"1":"DATA NOT AVAILABLE","107000000000000":"Leh (Ladakh)","108000000000000":"Kargil","102000000000000":"Baramula","101000000000000":"Kupwara","103000000000000":"Srinagar","106000000000000":"Anantnag","109000000000000":"Doda","105000000000000":"Pulwama","104000000000000":"Badgam","111000000000000":"Punch","112000000000000":"Rajauri","110000000000000":"Udhampur","203000000000000":"Lahul & Spiti","201000000000000":"Chamba","113000000000000":"Jammu","114000000000000":"Kathua","301000000000000":"Gurdaspur","202000000000000":"Kangra","204000000000000":"Kullu","212000000000000":"Kinnaur","305000000000000":"Hoshiarpur","302000000000000":"Amritsar","205000000000000":"Mandi","206000000000000":"Hamirpur","207000000000000":"Una","211000000000000":"Shimla","303000000000000":"Kapurthala","304000000000000":"Jalandhar","208000000000000":"Bilaspur","501000000000000":"Uttarkashi","307000000000000":"Rupnagar","209000000000000":"Solan","306000000000000":"Nawanshahr","311000000000000":"Firozpur","310000000000000":"Moga","502000000000000":"Chamoli","505000000000000":"Dehradun","210000000000000":"Sirmaur","309000000000000":"Ludhiana","601000000000000":"Panchkula","308000000000000":"Fatehgarh Sahib","504000000000000":"Tehri Garhwal","313000000000000":"Faridkot","503000000000000":"Rudraprayag","401000000000000":"Chandigarh","507000000000000":"Pithoragarh","317000000000000":"Patiala","316000000000000":"Sangrur","312000000000000":"Muktsar","314000000000000":"Bathinda","602000000000000":"Ambala","603000000000000":"Yamunanagar","901000000000000":"Saharanpur","508000000000000":"Bageshwar","513000000000000":"Hardwar","506000000000000":"Garhwal","604000000000000":"Kurukshetra","315000000000000":"Mansa","605000000000000":"Kaithal","801000000000000":"Ganganagar","611000000000000":"Sirsa","509000000000000":"Almora","606000000000000":"Karnal","802000000000000":"Hanumangarh","609000000000000":"Jind","610000000000000":"Fatehabad","903000000000000":"Bijnor","902000000000000":"Muzaffarnagar","511000000000000":"Nainital","612000000000000":"Hisar","510000000000000":"Champawat","607000000000000":"Panipat","1210000000000000":"Dibang Valley","512000000000000":"Udham Singh Nagar","1209000000000000":"Upper Siang","908000000000000":"Baghpat","608000000000000":"Sonipat","907000000000000":"Meerut","904000000000000":"Moradabad","905000000000000":"Rampur","906000000000000":"Jyotiba Phule Nagar","614000000000000":"Rohtak","613000000000000":"Bhiwani","803000000000000":"Bikaner","1207000000000000":"West Siang","804000000000000":"Churu","909000000000000":"Ghaziabad","920000000000000":"Bareilly","701000000000000":"North West","921000000000000":"Pilibhit","615000000000000":"Jhajjar","703000000000000":"North East","702000000000000":"North","911000000000000":"Bulandshahar","707000000000000":"West","1206000000000000":"Upper Subansiri","923000000000000":"Kheri","704000000000000":"East","708000000000000":"South West","706000000000000":"Central","910000000000000":"Gautam Buddha Nagar","705000000000000":"New Delhi","709000000000000":"South","1208000000000000":"East Siang","618000000000000":"Gurgaon","805000000000000":"Jhunjhunun","619000000000000":"Faridabad","919000000000000":"Budaun","1211000000000000":"Lohit","617000000000000":"Rewari","616000000000000":"Mahendragarh","922000000000000":"Shahjahanpur","950000000000000":"Bahraich","1205000000000000":"Lower Subansiri","806000000000000":"Alwar","813000000000000":"Sikar","912000000000000":"Aligarh","1101000000000000":"North","917000000000000":"Etah","816000000000000":"Jaisalmer","914000000000000":"Mathura","1814000000000000":"Tinsukia","1203000000000000":"East Kameng","951000000000000":"Shrawasti","1813000000000000":"Dhemaji","924000000000000":"Sitapur","1201000000000000":"Tawang","913000000000000":"Hathras","812000000000000":"Jaipur","952000000000000":"Balrampur","807000000000000":"Bharatpur","925000000000000":"Hardoi","1202000000000000":"West Kameng","929000000000000":"Farrukhabad","1212000000000000":"Changlang","814000000000000":"Nagaur","1815000000000000":"Dibrugarh","1204000000000000":"Papum Pare","1102000000000000":"West","815000000000000":"Jodhpur","1103000000000000":"South","1001000000000000":"Pashchim Champaran","916000000000000":"Firozabad","954000000000000":"Siddharthnagar","1812000000000000":"Lakhimpur","957000000000000":"Mahrajganj","918000000000000":"Mainpuri","1104000000000000":"East","953000000000000":"Gonda","915000000000000":"Agra","946000000000000":"Barabanki","959000000000000":"Kushinagar","1816000000000000":"Sibsagar","811000000000000":"Dausa","1213000000000000":"Tirap","930000000000000":"Kannauj","1901000000000000":"Darjiling","1817000000000000":"Jorhat","927000000000000":"Lucknow","958000000000000":"Gorakhpur","956000000000000":"Sant Kabir Nagar","955000000000000":"Basti","1811000000000000":"Sonitpur","1301000000000000":"Mon","1002000000000000":"Purba Champaran","926000000000000":"Unnao","809000000000000":"Karauli","931000000000000":"Etawah","1902000000000000":"Jalpaiguri","934000000000000":"Kanpur Nagar","821000000000000":"Ajmer","808000000000000":"Dhaulpur","1801000000000000":"Kokrajhar","932000000000000":"Auraiya","1808000000000000":"Darrang","2302000000000000":"Morena","1818000000000000":"Golaghat","1004000000000000":"Sitamarhi","1804000000000000":"Bongaigaon","947000000000000":"Faizabad","1807000000000000":"Nalbari","1805000000000000":"Barpeta","933000000000000":"Kanpur Dehat","1806000000000000":"Kamrup","2303000000000000":"Bhind","1302000000000000":"Tuensang","960000000000000":"Deoria","1303000000000000":"Mokokchung","810000000000000":"Sawai Madhopur","1810000000000000":"Nagaon","949000000000000":"Sultanpur","1005000000000000":"Madhubani","1003000000000000":"Sheohar","1015000000000000":"Gopalganj","948000000000000":"Ambedkar Nagar","1007000000000000":"Araria","1819000000000000":"Karbi Anglong","928000000000000":"Rae Bareli","822000000000000":"Tonk","1006000000000000":"Supaul","1008000000000000":"Kishanganj","1305000000000000":"Wokha","1903000000000000":"Koch Bihar","1809000000000000":"Marigaon","817000000000000":"Barmer","1904000000000000":"Uttar Dinajpur","820000000000000":"Pali","1802000000000000":"Dhubri","961000000000000":"Azamgarh","1013000000000000":"Darbhanga","935000000000000":"Jalaun","1014000000000000":"Muzaffarpur","1016000000000000":"Siwan","2304000000000000":"Gwalior","962000000000000":"Mau","2305000000000000":"Datia","1304000000000000":"Zunheboto","1803000000000000":"Goalpara","1017000000000000":"Saran","963000000000000":"Ballia","2301000000000000":"Sheopur","942000000000000":"Fatehpur","964000000000000":"Jaunpur","943000000000000":"Pratapgarh","938000000000000":"Hamirpur","1011000000000000":"Madhepura","1009000000000000":"Purnia","1705000000000000":"Ri Bhoi","1019000000000000":"Samastipur","1012000000000000":"Saharsa","825000000000000":"Rajsamand","1702000000000000":"East Garo Hills","1701000000000000":"West Garo Hills","1018000000000000":"Vaishali","1307000000000000":"Kohima","1306000000000000":"Dimapur","824000000000000":"Bhilwara","936000000000000":"Jhansi","965000000000000":"Ghazipur","2306000000000000":"Shivpuri","940000000000000":"Banda","823000000000000":"Bundi","1010000000000000":"Katihar","1704000000000000":"West Khasi Hills","1308000000000000":"Phek","830000000000000":"Kota","818000000000000":"Jalor","944000000000000":"Kaushambi","1820000000000000":"North Cachar Hills","1020000000000000":"Begusarai","1029000000000000":"Bhojpur","1030000000000000":"Buxar","945000000000000":"Allahabad","1707000000000000":"Jaintia Hills","1021000000000000":"Khagaria","1028000000000000":"Patna","1408000000000000":"Ukhrul","1706000000000000":"East Khasi Hills","939000000000000":"Mahoba","1401000000000000":"Senapati","1905000000000000":"Dakshin Dinajpur","967000000000000":"Varanasi","1703000000000000":"South Garo Hills","941000000000000":"Chitrakoot","2308000000000000":"Tikamgarh","966000000000000":"Chandauli","968000000000000":"Sant Ravidas Nagar","1906000000000000":"Maldah","1024000000000000":"Munger","1022000000000000":"Bhagalpur","1027000000000000":"Nalanda","831000000000000":"Baran","1402000000000000":"Tamenglong","1031000000000000":"Kaimur (Bhabua)","2309000000000000":"Chhatarpur","1032000000000000":"Rohtas","2009000000000000":"Sahibganj","1025000000000000":"Lakhisarai","1033000000000000":"Jehanabad","819000000000000":"Sirohi","1026000000000000":"Sheikhpura","969000000000000":"Mirzapur","2008000000000000":"Godda","937000000000000":"Lalitpur","829000000000000":"Chittaurgarh","2314000000000000":"Rewa","2313000000000000":"Satna","1037000000000000":"Jamui","2307000000000000":"Guna","1034000000000000":"Aurangabad","2310000000000000":"Panna","1821000000000000":"Cachar","1023000000000000":"Banka","1036000000000000":"Nawada","826000000000000":"Udaipur","1035000000000000":"Gaya","1406000000000000":"Imphal West","1407000000000000":"Imphal East","2318000000000000":"Neemuch","1822000000000000":"Karimganj","970000000000000":"Sonbhadra","1823000000000000":"Hailakandi","832000000000000":"Jhalawar","2010000000000000":"Pakaur","1907000000000000":"Murshidabad","2005000000000000":"Kodarma","2006000000000000":"Giridih","2319000000000000":"Mandsaur","1405000000000000":"Thoubal","2402000000000000":"Banas Kantha","1404000000000000":"Bishnupur","2317000000000000":"Sidhi","1403000000000000":"Churachandpur","2401000000000000":"Kachchh","2011000000000000":"Dumka","2002000000000000":"Palamu","1409000000000000":"Chandel","2007000000000000":"Deoghar","1908000000000000":"Birbhum","1604000000000000":"North Tripura","2004000000000000":"Hazaribagh","2001000000000000":"Garhwa","2003000000000000":"Chatra","2405000000000000":"Sabar Kantha","1502000000000000":"Kolasib","2312000000000000":"Damoh","2311000000000000":"Sagar","1503000000000000":"Aizawl","2331000000000000":"Vidisha","2322000000000000":"Shajapur","2316000000000000":"Shahdol","2330000000000000":"Rajgarh","1603000000000000":"Dhalai","1501000000000000":"Mamit","1601000000000000":"West Tripura","2403000000000000":"Patan","2338000000000000":"Katni","2404000000000000":"Mahesana","2202000000000000":"Surguja","2315000000000000":"Umaria","1910000000000000":"Nadia","1504000000000000":"Champhai","2012000000000000":"Dhanbad","827000000000000":"Dungarpur","2013000000000000":"Bokaro","828000000000000":"Banswara","2201000000000000":"Koriya","2320000000000000":"Ratlam","2332000000000000":"Bhopal","1909000000000000":"Barddhaman","1602000000000000":"South Tripura","2321000000000000":"Ujjain","2334000000000000":"Raisen","2014000000000000":"Ranchi","1914000000000000":"Puruliya","2015000000000000":"Lohardaga","2333000000000000":"Sehore","1913000000000000":"Bankura","2016000000000000":"Gumla","2339000000000000":"Jabalpur","1505000000000000":"Serchhip","2406000000000000":"Gandhinagar","2408000000000000":"Surendranagar","2407000000000000":"Ahmadabad","2417000000000000":"Panch Mahals","1506000000000000":"Lunglei","2341000000000000":"Dindori","2418000000000000":"Dohad","2323000000000000":"Dewas","1911000000000000":"North Twenty Four Parganas","2416000000000000":"Kheda","2203000000000000":"Jashpur","2340000000000000":"Narsimhapur","2324000000000000":"Jhabua","1912000000000000":"Hugli","2342000000000000":"Mandla","2017000000000000":"Pashchimi Singhbhum","2409000000000000":"Rajkot","2325000000000000":"Dhar","2207000000000000":"Bilaspur","2326000000000000":"Indore","2018000000000000":"Purbi Singhbhum","2205000000000000":"Korba","2337000000000000":"Hoshangabad","2344000000000000":"Seoni","2410000000000000":"Jamnagar","1915000000000000":"Medinipur","2419000000000000":"Vadodara","2343000000000000":"Chhindwara","1508000000000000":"Saiha","2204000000000000":"Raigarh","1916000000000000":"Haora","1507000000000000":"Lawngtlai","2415000000000000":"Anand","1917000000000000":"KolKata","1918000000000000":"South  Twenty Four Parganas","2336000000000000":"Harda","2107000000000000":"Mayurbhanj","2327000000000000":"West Nimar","2208000000000000":"Kawardha","2105000000000000":"Sundargarh","2329000000000000":"East Nimar","2335000000000000":"Betul","2345000000000000":"Balaghat","2414000000000000":"Bhavnagar","2206000000000000":"Janjgir - Champa","2421000000000000":"Bharuch","2103000000000000":"Sambalpur","2106000000000000":"Kendujhar","2328000000000000":"Barwani","2420000000000000":"Narmada","2210000000000000":"Durg","2413000000000000":"Amreli","2701000000000000":"Nandurbar","2102000000000000":"Jharsuguda","2411000000000000":"Porbandar","2108000000000000":"Baleshwar","2211000000000000":"Raipur","2209000000000000":"Rajnandgaon","2707000000000000":"Amravati","2104000000000000":"Debagarh","2101000000000000":"Bargarh","2709000000000000":"Nagpur","2115000000000000":"Anugul","2412000000000000":"Junagadh","2711000000000000":"Gondiya","2702000000000000":"Dhule","2710000000000000":"Bhandara","2212000000000000":"Mahasamund","2422000000000000":"Surat","2703000000000000":"Jalgaon","2708000000000000":"Wardha","2704000000000000":"Buldana","2705000000000000":"Akola","2109000000000000":"Bhadrak","2114000000000000":"Dhenkanal","2123000000000000":"Sonapur","2113000000000000":"Jajapur","2125000000000000":"Nuapada","2423000000000000":"The Dangs","2424000000000000":"Navsari","2124000000000000":"Balangir","2213000000000000":"Dhamtari","2122000000000000":"Baudh","2720000000000000":"Nashik","2712000000000000":"Gadchiroli","2110000000000000":"Kendrapara","2706000000000000":"Washim","2425000000000000":"Valsad","2713000000000000":"Chandrapur","2112000000000000":"Cuttack","2501000000000000":"Diu","2719000000000000":"Aurangabad","2121000000000000":"Kandhamal","2714000000000000":"Yavatmal","2718000000000000":"Jalna","2116000000000000":"Nayagarh","2214000000000000":"Kanker","2502000000000000":"Daman","2126000000000000":"Kalahandi","2117000000000000":"Khordha","2111000000000000":"Jagatsinghapur","2601000000000000":"Dadra & Nagar Haveli","2119000000000000":"Ganjam","2721000000000000":"Thane","2118000000000000":"Puri","2215000000000000":"Bastar","2128000000000000":"Nabarangapur","2716000000000000":"Hingoli","2726000000000000":"Ahmadnagar","2127000000000000":"Rayagada","2715000000000000":"Nanded","2801000000000000":"Adilabad","2717000000000000":"Parbhani","2120000000000000":"Gajapati","2727000000000000":"Bid","2216000000000000":"Dantewada","2725000000000000":"Pune","2722000000000000":"Mumbai Suburban","2129000000000000":"Koraput","2812000000000000":"Vizianagaram","2811000000000000":"Srikakulam","2724000000000000":"Raigarh","2723000000000000":"Mumbai","2803000000000000":"Karimnagar","2802000000000000":"Nizamabad","2728000000000000":"Latur","2130000000000000":"Malkangiri","2729000000000000":"Osmanabad","2810000000000000":"Khammam","2809000000000000":"Warangal","2730000000000000":"Solapur","2813000000000000":"Visakhapatnam","2905000000000000":"Bidar","2804000000000000":"Medak","2731000000000000":"Satara","2732000000000000":"Ratnagiri","2814000000000000":"East Godavari","2808000000000000":"Nalgonda","2904000000000000":"Gulbarga","2806000000000000":"Rangareddi","2735000000000000":"Sangli","2815000000000000":"West Godavari","2903000000000000":"Bijapur","2805000000000000":"Hyderabad","2807000000000000":"Mahbubnagar","2734000000000000":"Kolhapur","2816000000000000":"Krishna","2901000000000000":"Belgaum","2817000000000000":"Guntur","2902000000000000":"Bagalkot","3401000000000000":"Yanam","2733000000000000":"Sindhudurg","2906000000000000":"Raichur","2818000000000000":"Prakasam","2821000000000000":"Kurnool","2907000000000000":"Koppal","2908000000000000":"Gadag","2912000000000000":"Bellary","3001000000000000":"North Goa","2909000000000000":"Dharwad","2910000000000000":"Uttara Kannada","3002000000000000":"South Goa","2820000000000000":"Cuddapah","2822000000000000":"Anantapur","2911000000000000":"Haveri","2819000000000000":"Nellore","2913000000000000":"Chitradurga","2914000000000000":"Davanagere","2915000000000000":"Shimoga","2918000000000000":"Tumkur","2823000000000000":"Chittoor","2919000000000000":"Kolar","2916000000000000":"Udupi","2917000000000000":"Chikmagalur","3501000000000000":"Andamans","3301000000000000":"Thiruvallur","2923000000000000":"Hassan","2921000000000000":"Bangalore Rural","2920000000000000":"Bangalore","3304000000000000":"Vellore","2924000000000000":"Dakshina Kannada","3302000000000000":"Chennai","2922000000000000":"Mandya","3303000000000000":"Kancheepuram","3305000000000000":"Dharmapuri","3306000000000000":"Tiruvannamalai","2925000000000000":"Kodagu","3201000000000000":"Kasaragod","2926000000000000":"Mysore","3307000000000000":"Viluppuram","2927000000000000":"Chamarajanagar","3202000000000000":"Kannur","3402000000000000":"Pondicherry","3203000000000000":"Wayanad","3308000000000000":"Salem","3310000000000000":"Erode","3318000000000000":"Cuddalore","3204000000000000":"Kozhikode","3403000000000000":"Mahe","3311000000000000":"The Nilgiris","3101000000000000":"Lakshadweep","3309000000000000":"Namakkal","3205000000000000":"Malappura","3316000000000000":"Perambalur","3319000000000000":"Nagapattinam","3317000000000000":"Ariyalur","3312000000000000":"Coimbatore","3315000000000000":"Tiruchirappalli","3206000000000000":"Palakkad","3321000000000000":"Thanjavur","3314000000000000":"Karur","3320000000000000":"Thiruvarur","3404000000000000":"Karaikal","3313000000000000":"Dindigul","3207000000000000":"Thrissur","3322000000000000":"Pudukkottai","3323000000000000":"Sivaganga","3209000000000000":"Idukki","3324000000000000":"Madurai","3208000000000000":"Ernakulam","3325000000000000":"Theni","3327000000000000":"Ramanathapuram","3211000000000000":"Alappuzha","3210000000000000":"Kottayam","3326000000000000":"Virudhunagar","3212000000000000":"Pathanamt","3329000000000000":"Tirunelveli","3328000000000000":"Thoothukkudi","3502000000000000":"Nicobars","3213000000000000":"Kollam","3214000000000000":"Thiruvana","3330000000000000":"Kanniyakumari"},
    indicName = $("#indicMenu option:selected").text(),
    currentYear = $("#yearMenu option:selected").text(),
    worstState = {},
    bestState = {},
    worstDistrict = {},
    bestDistrict = {},
    indicObjState={}, indicObjDistrict={},
    indicArrayState, indicArrayDistrict=[],
    dataranks = {},
    ranktotal,
    chartWidth = 700, chartHeight = 500,
    mapWidth = 530, mapHeight = 500,
    thousands = d3.format(","),
    pct = d3.format(".2f"),
    pctAxis = d3.format(".1f"),
    natNum = d3.format(".0f"),
    x,
    y = d3.scale.linear().domain([]).range([320, 0]),
    yAxis = d3.svg.axis().scale(y).orient("right").tickSize(13).tickFormat(function(d) {return pctAxis(d);}),
    color = d3.scale.threshold().domain([]).range([]),
    state,
    districtdatabykey={},
    selectedDistricts,
    level="district",
    prevLevel,
    districtsMax,
    statesMax,
    fileLookupState = {'2012-2013': 'data/state_misindics1213_ccodes.csv', '2013-2014': 'data/state_misindics1314_ccodes.csv'},
    fileLookupDistrict = {'2012-2013': 'data/dist_misindics1213_forshp2001.csv', '2013-2014': 'data/dist_misindics1314_forshp2001.csv'};

    var chart1svg = d3.select("#chart1").append("svg")
        .attr("width", chartWidth)
        .attr("height", chartHeight)
        .attr("id", "chart1svg")
        .style("font", "10px sans-serif");

    chart1svg.append("rect").attr("width",chartWidth).attr("height",chartHeight).style("fill","rgb(250,250,250").attr("id", "background")

    var mapsvg = chart1svg.append("svg")
        .attr("width", mapWidth)
        .attr("height", mapHeight);

    var boundmesh = mapsvg.append("path");

    loadIndicState(currentYear, states_indicators)
    var states_indicators;
    loadIndicDistrict(currentYear, districts_indicators);
    var districts_indicators;
    var districts_map = districts_cens;

    rescale();

    var g = chart1svg.append("g")
        .attr("class", "key")
        .attr("transform", "translate(560,"+(90)+")");
    
    g.selectAll("rect")
        .data(color.range().map(function(d, i) {
          return {
            x0: i ? y(color.domain()[i - 1]) : y.range()[0],
            x1: i < color.domain().length ? y(color.domain()[i]) : y.range()[1],
            z: d
          };
        }))
        .enter().append("rect")
        .attr("height", function(d,i) { return d.x0 - d.x1})
        .attr("y", function(d, i) { return d.x1; })
        .attr("width", 8)
        .style("fill", function(d) { return d.z; });

    g.call(yAxis).append("text")
        .attr("class", "caption")
        .text(indicName)
        .attr("y", -30)
        .attr("x", -45)
        .style("font-weight", "bold")
        .style("font-size", "12px");

    g.selectAll("path").style("display","none");
    g.selectAll("line").style("stroke", "#000").style("shape-rendering", "crispEdges");

	var projection = d3.geo.mercator()
		.center([81.8718, 23.3])
		.scale(750)
		.translate([mapWidth / 2, mapHeight / 2]);

	var path = d3.geo.path().projection(projection);

    var states = mapsvg.selectAll(".state")
        .data(topojson.feature(states_cens, states_cens.objects.states).features)
        .enter().append("path").attr("d",path)
        .style("fill", function(d, i) { 
            var id = d.properties.state_id
            if (indicObjState[currentYear][id]===undefined) { 
                return 'rgb(200,200,200)' 
            } 
            else { 
                return color(indicObjState[currentYear][id][indicName]) 
            }
        })
        .attr("class","state")
        .attr("id", function(d,i) { return d.properties.state_id })
        .attr("state-name", function(d,i) { return stateNames[d.properties.state_id]})
        .attr("state-id", function(d,i) {return d.properties.state_id})
        .attr("rank-title", function(d,i) {
            return buildRankTitle(d,i) 
        })
        .attr("data-title", function(d,i) {
            return buildDataTitle(d,i)
        })
        .style("cursor","pointer")
        .on("mouseover",mouseover)
        .on("mouseout",mouseout)
        .on("click", clicked);

    mapsvg.append("path")
        .datum(topojson.mesh(states_cens, states_cens.objects.states, function(a, b) { return a !== b ; }))
        .attr("d", path)
        .attr("class", "state-boundary")
        .style("fill","none")
        .style("stroke","#fff")
        .style("stroke-width","1px")
        .style("stroke-linejoin","round")
        .style("stroke-linecap", "round")
        .style("pointer-events","none");

    var states_cens;

    var districts = mapsvg.selectAll(".district")
        .data(topojson.feature(districts_cens, districts_map.objects.districts).features)
        .enter().append("path")
        .attr("class", "district")
        .attr("d", path)
        .attr("state-id", function(d,i) {
            if (d.properties.district_id_shp2001!==undefined) {
                var str = d.properties.district_id_shp2001
                d.properties.state_id= +str.substr(0,2)
                return +str.substr(0,2)
            }
            else {d.properties.district_id_shp2001="01"; return "01"}
        })
        .attr("state-name", function(d,i){ 
            if (d.properties.district_id_shp2001!==undefined) {
                var str = d.properties.district_id_shp2001
                return stateNames[+str.substr(0,2)]
            }
            else {return stateNames[1]}
        })
        .attr("district-name", function(d,i){ 
            if (d.properties.district_id_shp2001=="01"){return "PoK"}
            else {return d.properties.district_name}
        })
        .attr("district-id", function(d,i){
            //districtNames[+d.properties.district_id_shp2001]= d.properties.district_name
            if (d.properties.district_id_shp2001=="01"){return "01"}
            else {return +d.properties.district_id_shp2001}
        })
        .style("fill","none")
        .style("pointer-events", "none")
        .style("cursor","pointer")
        .on("click", clicked);
    $('#yearMenu').change(function() {
        currentYear = $("#yearMenu option:selected").text();
        if (!indicObjState[currentYear]) {
            function loadYear(error, states_data, districts_data) {
                loadIndicState(currentYear, states_data);
                loadIndicDistrict(currentYear, districts_data);
                rescale();
                restyleState();
                refreshLegend();
                if (level==="state") restyleDistrict();
            }
            queue()
                .defer(d3.csv, fileLookupState[currentYear])
                .defer(d3.csv, fileLookupDistrict[currentYear])
                .await(loadYear);
        }
        else {
            loadIndicState(currentYear);
            loadIndicDistrict(currentYear);
            rescale();
            restyleState();
            refreshLegend();
            if (level==="state") restyleDistrict();
        }
    });

    $('#indicMenu').change(function() {
        indicName = $("#indicMenu option:selected").text();
        loadIndicState(currentYear);
        loadIndicDistrict(currentYear);
        rescale();
        restyleState();
        refreshLegend();
        if (level==="state") restyleDistrict();
    });

    d3.select("#background").on("click", clicked);

    function restyleState() {
        states
            .style("fill", function(d, i) { 
                var id = d.properties.state_id;
                return indicObjState[currentYear][id]===undefined ? 'rgb(200,200,200)' : color(indicObjState[currentYear][id][indicName]);
            })
            .attr("rank-title", function(d,i) { return buildRankTitle(d,i); })
            .attr("data-title", function(d,i) { return buildDataTitle(d,i); });
    }

    function restyleDistrict() {
        mapsvg.selectAll('.district[state-id="'+state+'"]')
        .style("fill", function(d, i) { 
            if (districtdatabykey[currentYear][d3.select(this).attr("district-id")]!==undefined) {
                return (districtdatabykey[currentYear][d3.select(this).attr("district-id")]['value']===null) ? 'rgb(200,200,200)' : color(districtdatabykey[currentYear][d3.select(this).attr("district-id")]['value']) 
             }
            else {return 'rgb(200,200,200)'}

        }).attr("data-title", function() {
                var valStr = '';
                if (indicName=='Households worked (lakhs)' || indicName==='Person-days per household worked' || indicName==='Average wage' || indicName==='Person-days per rural household') {
                    valStr = pct(districtdatabykey[currentYear][d3.select(this).attr("district-id")]['value'])
                }
                if (indicName=='Percent female person-days' || indicName==='Percent SC person-days' || indicName==='Percent ST person-days' || indicName==='Percent rural households worked') {
                    valStr = pct(districtdatabykey[currentYear][d3.select(this).attr("district-id")]['value'])+"%"
                }
                return districtdatabykey[currentYear][d3.select(this).attr("district-id")]['value']===null ? "<b>"+d3.select(this).attr("state-name")+"</b><br>"+"<b>"+d3.select(this).attr("district-name")+"</b><br>"+"No data" : "<b>"+d3.select(this).attr("state-name")+"</b><br>"+"<b>"+d3.select(this).attr("district-name")+"</b><br>"+indicName+": "+valStr;})
            .attr("rank-title", function() {
                var key = d3.select(this).attr("district-id");
                var bestDistStr = '';
                var worstDistStr = '';
                if (indicName=='Households worked (lakhs)' || indicName==='Person-days per household worked' || indicName==='Average wage' || indicName==='Person-days per rural household') {
                    bestDistStr = "<br>Best performer: "+districtdatabykey[currentYear][key].bestDistName+" ("+pct(districtdatabykey[currentYear][key].bestDistVal)+")"
                    worstDistStr = "<br>Worst performer: "+districtdatabykey[currentYear][key].worstDistName+" ("+pct(districtdatabykey[currentYear][key].worstDistVal)+")"
                }
                if (indicName=='Percent female person-days' || indicName==='Percent SC person-days' || indicName==='Percent ST person-days' || indicName==='Percent rural households worked') {
                    bestDistStr = "<br>Best performer: "+districtdatabykey[currentYear][key].bestDistName+" ("+pct(districtdatabykey[currentYear][key].bestDistVal)+"%)"
                    worstDistStr = "<br>Worst performer: "+districtdatabykey[currentYear][key].worstDistName+" ("+pct(districtdatabykey[currentYear][key].worstDistVal)+"%)"
                }
                return districtdatabykey[currentYear][key].rank===undefined
                ? "Rank: -/"+districtdatabykey[currentYear][key].distTotal+bestDistStr+worstDistStr
                : "Rank: "+districtdatabykey[currentYear][key].rank+"/"+districtdatabykey[currentYear][key].distTotal +bestDistStr+worstDistStr
            });

    }
    
    // tooltip functions
    function mouseover() {
    	thisTitle = d3.select(this).attr("data-title");
        thisRank = d3.select(this).attr("rank-title")
        d3.select("#tiptext").html(thisTitle);
        d3.select("#ranktext").html(thisRank)
    	d3.select("#tooltipDiv")
    	.style("opacity",0)
    	.style("display","block")
    	.style("left", d3.mouse(d3.select("body")[0][0])[0]+"px")
    	.style("top",d3.mouse(d3.select("body")[0][0])[1]+20+"px")
    	.transition()
    	.style("opacity",1).duration(200);
    	d3.select(this).style("fill-opacity",.8)
    }

    function mouseout() {
    	d3.select("#tooltipDiv")
    	.style("display","none");
    	d3.select(this).style("fill-opacity", 1);
    }

    function rescale() {
        var max = d3.max([statesMax, districtsMax])
        if (indicName==='Percent female person-days') {
            var bounds = ([10, 20, 33.33, 40, 50, 60, 70, 100]);
            var colorArray = ["#CB181D", "#EF3B2C", "#FB6A4A", "#A1D99B", "#74C476", "#41AB5D", "#238B45", "#005A32"];
            y.domain([0,100]);
                //.range(["#B63132", "#d28158", "#ECCB7B", "#f4df8e", "#CCDBA3", "#76a19a", "#276c91"]); // nyt mobility map
                //.range(["#B63132", "#d28158", "#ECCB7B", "#CCDBA3", "#76a19a", "#276c91"]); // nyt mobility map 6 colors
                //.range(["#9f2631", '#c04d3f', "#d07c56", "#CCDBA3", "#76a19a", "#276c91"]); // nyt mobility map 6 colors no yellow ** i like this one
                //.range(["rgb(227, 26, 28)", "rgb(252, 78, 42)", "rgb(253, 141, 60)", "#CCDBA3", "#76a19a", "#276c91"]); // nyt mobility map in gr-bl, rd-org
                //.range(["rgb(189, 0, 38)","rgb(240, 59, 32)","rgb(253, 141, 60)","rgb(254, 178, 76)","rgb(254, 217, 118)"]);
                // red-or-yl
        }
        if (indicName==='Person-days per rural household' || indicName==='Person-days per household worked') {  
            var colorArray = ["#CB181D", "#EF3B2C", "#FB6A4A", "#FC9272", "#A1D99B", "#74C476", "#41AB5D", "#238B45"];
            var bounds = ([10, 20, 30, 40, 50, 60, 70, 100.0001]);
            if (max>100) {
                bounds = ([10, 20, 30, 40, 50, 60, 100, max*1.05]);
                colorArray = ["#CB181D", "#EF3B2C", "#FB6A4A", "#FC9272", "#74C476", "#41AB5D", "#238B45", "steelblue"];
            }
            y.domain([0, bounds[7]])
        }
        if (indicName==='Percent SC person-days' || indicName==='Percent ST person-days') {
            var bounds = ([10, 20, 30, 40, 50, 60, 70, 100.001])
            var colorArray = ["#CB181D", "#EF3B2C", "#FB6A4A", "#FC9272", "#A1D99B", "#74C476", "#41AB5D", "#238B45"];
            //var colorArray = ["#fff","#fff","#9f2631", '#c04d3f', "#d07c56", "#CCDBA3", "#76a19a", "#276c91"]
            y.domain([0, 100]);
        }
        if (indicName==='Average wage') {
            var array = [];
            var maxChart;
            if (max===0 || isNaN(max)) maxChart=1;
            else maxChart = max*1.05;
            for (var i=1; i<=8;i++) {
                array.push((maxChart*i)/8)
            }
            var bounds = (array)
            var colorArray = ["#CB181D", "#EF3B2C", "#FB6A4A", "#FC9272", "#A1D99B", "#74C476", "#41AB5D", "#238B45"]
            y.domain([0, maxChart])
        }
        if (indicName==='Percent rural households worked') {
            var array = [];
            var colorArray = ["#CB181D", "#EF3B2C", "#FB6A4A", "#FC9272", "#A1D99B", "#74C476", "#41AB5D", "#238B45"]
            var maxChart = max*1.05;
            if (max===0 || isNaN(max)) maxChart=1
            if (max<=100) {
                maxChart=100
                array = [10, 20, 30, 40, 50, 60, 70, 100.001]
            }
            if (max>100) {
                array = [10, 20, 30, 40, 50, 60, 100.001, maxChart]
                colorArray = ["#CB181D", "#EF3B2C", "#FB6A4A", "#FC9272", "#74C476", "#41AB5D", "#238B45", "steelblue"]
            }
            bounds = (array)
            y.domain([0, maxChart]);
        }
        yAxis.tickValues([0].concat(bounds))
        color.domain(bounds).range(colorArray); 
    }

    function refreshLegend() {
        g.selectAll("rect")
        .data(color.range().map(function(d, i) {
          return {
            x0: i ? y(color.domain()[i - 1]) : y.range()[0],
            x1: i < color.domain().length ? y(color.domain()[i]) : y.range()[1],
            z: d
          };
        }))
        .attr("height", function(d,i) { return d.x0 - d.x1})
        .attr("y", function(d, i) { return d.x1; })
        .style("fill", function(d) { return d.z; });

        d3.select('.caption')
        .text(indicName)
        .attr("x", function() {
            if (indicName==='Average wage') return -10;
            if (indicName==='Percent female person-days') return -45;
            if (indicName==='Households worked (lakhs)') return -54;
            if (indicName==='Person-days per household worked') return -70;
            if (indicName==='Person-days per rural household') return -60;
            if (indicName==='Percent rural households worked') return -60;
            if (indicName==='Percent SC person-days' || indicName==='Percent ST person-days') return -50;
        });

        g.call(yAxis)
        g.selectAll("line").style("stroke", "#000").style("shape-rendering", "crispEdges");
    }

    function clicked(d, i) {
        level = d3.select(this).attr("class");
        if (level!=null) state = d3.select(this).attr("state-id");
        if (level==="state") d3.select("#hoverLabel2").html('Single-click the map<br>to zoom out');
        if (level===null || level==="district") d3.select("#hoverLabel2").html('Single-click a state<br>to zoom in');
        var id=i;
        var x, yy, k;
        if (d && level==="state") { // not yet zoomed
            var center = path.bounds(d)
            x = d3.mean([center[1][0],center[0][0]])
            yy = d3.mean([center[1][1],center[0][1]])
            if (state==="35") {
                x=438.74009347444667;
                yy=417.14770830749137 
            }
            k = 3.5;
        } 
        else { // already zoomed
            x = mapWidth / 2;
            yy= mapHeight / 2;
            k = 1;
            centered = null;
        }

        if (level==="state") {
            mapsvg.selectAll('.district[state-id="'+state+'"]')
                .style("fill", function(d, i) { 
                    if (districtdatabykey[currentYear][d3.select(this).attr("district-id")]!==undefined) {
                        return (districtdatabykey[currentYear][d3.select(this).attr("district-id")]['value']===null) ? 'rgb(200,200,200)' : color(districtdatabykey[currentYear][d3.select(this).attr("district-id")]['value']) 
                    }
                    else {return 'rgb(200,200,200)'}

                })
                .style("opacity", function() {if (navigator.userAgent.toLowerCase().indexOf('firefox') > -1) return 0; else return 1;});

            mapsvg.selectAll(".state, .state-boundary")
              .style("opacity",1)
              .transition()
              .style("opacity",0)
              .style("pointer-events", "none")
              ;

            selectedDistricts = {type: "GeometryCollection", geometries: []}
            districts_map.objects.districts.geometries.forEach(function(d,i) {
                if (d.properties.state_id==state) selectedDistricts.geometries.push(d);
            });
            boundmesh.remove();
            boundmesh = mapsvg.append("path")
                .datum(topojson.mesh(districts_map, selectedDistricts, function(a, b) { return a !== b ; }))
                .attr("d", path)
                .attr("class", "district-boundary")
                .style("fill","none")
                .style("stroke","#fff")
                .style("stroke-width",".5px")
                .style("stroke-linejoin","round")
                .style("stroke-linecap","round")
                .style("pointer-events","none")
                .style("opacity", function() {if (navigator.userAgent.toLowerCase().indexOf('firefox') > -1) return 0; else return 1;});
        }

        if (navigator.userAgent.toLowerCase().indexOf('firefox') > -1) {

            if (level==="state") {
                mapsvg.selectAll('.district[state-id="'+state+'"], .district-boundary')
                    .attr("transform", "translate(" + mapWidth / 2 + "," + mapHeight / 2 + ") scale(" + k + ") translate(" + -x + "," + -yy + ")")
                    .style("stroke-width", .5 / k + "px")
                    .transition().duration(750)
                    .style("opacity", function() { return level==="state" ? 1: 0})
                    .each("end", endFunction);
            }
            else {
                mapsvg.selectAll('.district[state-id="'+state+'"], .district-boundary')
                    .transition().duration(750)
                    .style("opacity", function() { return level==="state" ? 1: 0})
                    .each("end", endFunction);
            }
        }
        else {
            mapsvg.selectAll('.district[state-id="'+state+'"], .district-boundary').transition()
                .duration(750)
                .attr("transform", "translate(" + mapWidth / 2 + "," + mapHeight / 2 + ") scale(" + k + ") translate(" + -x + "," + -yy + ")")
                .style("stroke-width", .5 / k + "px")
                .each("end", endFunction);
        }

        function endFunction(d,i){
            if (level==="state" && d3.select(this).attr("class")==="district") {
                d3.select(this)
                .attr("data-title", function() {
                    var valStr = '';
                    if (indicName=='Households worked (lakhs)' || indicName==='Person-days per household worked' || indicName==='Average wage' || indicName==='Person-days per rural household') {
                        valStr = pct(districtdatabykey[currentYear][d3.select(this).attr("district-id")]['value'])
                    }
                    if (indicName=='Percent female person-days' || indicName==='Percent SC person-days' || indicName==='Percent ST person-days' || indicName==='Percent rural households worked') {
                        valStr = pct(districtdatabykey[currentYear][d3.select(this).attr("district-id")]['value'])+"%"
                    }
                    return districtdatabykey[currentYear][d3.select(this).attr("district-id")]['value']===null ? "<b>"+d3.select(this).attr("state-name")+"</b><br>"+"<b>"+d3.select(this).attr("district-name")+"</b><br>"+"No data" : "<b>"+d3.select(this).attr("state-name")+"</b><br>"+"<b>"+d3.select(this).attr("district-name")+"</b><br>"+indicName+": "+valStr;})
                .attr("rank-title", function() {
                    var key = d3.select(this).attr("district-id");
                    var bestDistStr = '';
                    var worstDistStr = '';
                    if (indicName=='Households worked (lakhs)' || indicName==='Person-days per household worked' || indicName==='Average wage' || indicName==='Person-days per rural household') {
                        bestDistStr = "<br>Best performer: "+districtdatabykey[currentYear][key].bestDistName+" ("+pct(districtdatabykey[currentYear][key].bestDistVal)+")"
                        worstDistStr = "<br>Worst performer: "+districtdatabykey[currentYear][key].worstDistName+" ("+pct(districtdatabykey[currentYear][key].worstDistVal)+")"
                    }
                    if (indicName=='Percent female person-days' || indicName==='Percent SC person-days' || indicName==='Percent ST person-days' || indicName==='Percent rural households worked') {
                        bestDistStr = "<br>Best performer: "+districtdatabykey[currentYear][key].bestDistName+" ("+pct(districtdatabykey[currentYear][key].bestDistVal)+"%)"
                        worstDistStr = "<br>Worst performer: "+districtdatabykey[currentYear][key].worstDistName+" ("+pct(districtdatabykey[currentYear][key].worstDistVal)+"%)"
                    }
                    return districtdatabykey[currentYear][key].rank===undefined
                    ? "Rank: -/"+districtdatabykey[currentYear][key].distTotal+bestDistStr+worstDistStr
                    : "Rank: "+districtdatabykey[currentYear][key].rank+"/"+districtdatabykey[currentYear][key].distTotal +bestDistStr+worstDistStr
                })
                .style("pointer-events","all")
                .on("mouseover",mouseover)
                .on("mouseout",mouseout);
            }

            if (level!="state") {
                d3.select(this)
                //.style("opacity",1)
                .transition()
                .style("opacity",0)
                .style("pointer-events", "none")
                ;

                if (i===0) {
                    mapsvg.selectAll(".state-boundary")
                        .transition()
                        .style("opacity",1)
                         ;
                    mapsvg.selectAll(".state")
                        .transition()
                        .style("opacity",1)
                        .style("pointer-events", "all")
                        ;
                }
            }
        }
    }

    function loadIndicDistrict(year, newdata) {
        var obj = []
        indicArrayDistrict = {1:[],2:[],3:[],4:[],5:[],6:[],7:[],8:[],9:[],10:[],11:[],12:[],13:[],14:[],15:[],16:[],17:[],18:[],19:[],20:[],21:[],22:[],23:[],24:[],25:[],26:[],27:[],28:[],29:[],30:[],31:[],32:[],33:[],34:[],35:[]};
        if (indicObjDistrict[year]===undefined && newdata!==undefined) {
            //console.log("year not in snowball")
            indicObjDistrict[year] = {};
            districtdatabykey[year]={};
            newdata.forEach(function(d,i) {
                d.state_id = +d.state_id
                d.district_id_shp2001= +d.district_id_shp2001
                var tempVal;
                if (d[indicName]==="" || d[indicName]===null) {
                    tempVal=null
                }
                else {
                    tempVal= +d[indicName]
                }
                obj.push({'state_id': d.state_id, 'district_id_shp2001': d.district_id_shp2001, 'value': tempVal})
                indicObjDistrict[year][d.district_id_shp2001]=d
                indicArrayDistrict[d.state_id].push( tempVal)
            });
        }

        if (newdata===undefined) {
            var keys = Object.keys(indicObjDistrict[year])
            keys.forEach(function(d,i) {
                if (indicObjDistrict[year][d][indicName]==="" || indicObjDistrict[year][d][indicName]===null) {
                    indicObjDistrict[year][d][indicName]=null
                }
                else {
                    indicObjDistrict[year][d][indicName]= +indicObjDistrict[year][d][indicName]
                }
                obj.push({'state_id': indicObjDistrict[year][d]['state_id'], 'district_id_shp2001': indicObjDistrict[year][d]['district_id_shp2001'], 'value': indicObjDistrict[year][d][indicName]})
                indicArrayDistrict[indicObjDistrict[year][d].state_id].push( indicObjDistrict[year][d][indicName])
            });
        }
        [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35].forEach(function(d,i){
            var array = [];
            obj.forEach(function(e) {
                if (e.state_id===d) array.push(e)
            })
            array.sort(function(a,b) {
                if (a.value===null) return 1;
                else return b.value-a.value;
            })
            var total=0;
            array.forEach(function(e,i){
                if (e.value!==null) e.rank = i+1;
                if (e.value!==null) total+=1
            });
            obj.forEach(function(e,i) {
                if (e.state_id===d) {
                    e.bestDistName=districtNames[array[0].district_id_shp2001]
                    e.bestDistVal=array[0]['value']
                    if (total>0) e.worstDistName=districtNames[array[total-1].district_id_shp2001]
                    if (total>0) e.worstDistVal=array[total-1]['value']
                    e.distTotal=total
                }
            });
        });
        obj.forEach(function(d,i) {
            districtdatabykey[year][d.district_id_shp2001]=d
        });

        districtsMax = 0;
        var keys = Object.keys(indicArrayDistrict)
        keys.forEach(function(d,i) {
            if (d3.max(indicArrayDistrict[d]) > districtsMax) districtsMax = d3.max(indicArrayDistrict[d])
        });

    }

    function loadIndicState(year, newdata) {
        var obj = []
        indicArrayState = []
        // does the year exist in the snowball?
        // request the data if it doesn't yet exist
        // add the year to the snowball if it doesn't yet exist
        if (indicObjState[year]===undefined && newdata!==undefined) {
            //console.log("year not in snowball")
            indicObjState[year] = {};
            newdata.forEach(function(d,i) {
                d.state_id = +d.state_id
                var tempVal;
                if (d[indicName]==="" || d[indicName]===null) {
                    tempVal=null
                }
                else {
                    tempVal= +d[indicName]
                }
                obj.push({'state_id': d.state_id, 'value': tempVal})
                indicObjState[year][d.state_id]=d
                indicArrayState.push(tempVal)

            });
        }
        if (newdata===undefined) {
            var keys = Object.keys(indicObjState[year])
            keys.forEach(function(d,i) {
                var tempVal;
                if (indicObjState[year][d][indicName]==="" || indicObjState[year][d][indicName]===null) {
                    tempVal=null
                }
                else {
                    tempVal= +indicObjState[year][d][indicName]
                }
                indicObjState[year][d][indicName]= tempVal;
                obj.push({'state_id': indicObjState[year][d]['state_id'], 'value': tempVal})
                indicArrayState.push(tempVal)
            });
        }
        dataranks = obj;
        dataranks.sort(function(a,b){
            if (a['value']===null) { return 1}
            else {return b['value']-a['value']}
        });

        ranktotal=0
        dataranks.forEach(function(d,i){
            if (d['value']===null) {}
            else {
                d.rank = i+1;
                ranktotal+=1
            }
        });

        dataranks.forEach(function(d,i) {
            var id=d.state_id;
            indicObjState[year][id].rank=d.rank
            indicObjState[year][id].ranktotal=ranktotal
        });

        bestState.name=stateNames[dataranks[0].state_id];
        bestState.value=dataranks[0]['value']
        worstState.name=stateNames[dataranks[ranktotal-1].state_id]
        worstState.value=dataranks[ranktotal-1]['value']

        statesMax = 0;
        if (d3.max(indicArrayState)>statesMax) statesMax = d3.max(indicArrayState);

        var obj;
        var newdata;
    }

    function buildRankTitle(d,i) {
        var id=d.properties.state_id
        if (indicName=='Households worked (lakhs)' || indicName==='Person-days per household worked' || indicName==='Average wage' || indicName==='Person-days per rural household') {
            if (indicObjState[currentYear][id]===undefined) {
                return "Rank: -/"+ranktotal+"<br>Best performer: "+bestState.name+" ("+pct(bestState.value)+")"+"<br>Worst performer: "+worstState.name+" ("+pct(worstState.value)+")"
            }
            else {
                return (indicObjState[currentYear][id].rank===null)
                    ? "Rank: -/"+ranktotal+"<br>Best performer: "+bestState.name+" ("+pct(bestState.value)+")"+"<br>Worst performer: "+worstState.name+" ("+pct(worstState.value)+")"
                    : "Rank: "+indicObjState[currentYear][id].rank+"/"+ranktotal +"<br>Best performer: "+bestState.name+" ("+pct(bestState.value)+")"+"<br>Worst performer: "+worstState.name+" ("+pct(worstState.value)+")"
            }
        }
        if (indicName=='Percent female person-days' || indicName==='Percent SC person-days' || indicName==='Percent ST person-days' || indicName==='Percent rural households worked') {
            if (indicObjState[currentYear][id]===undefined) {
                return "Rank: -/"+ranktotal+"<br>Best performer: "+bestState.name+" ("+pct(bestState.value)+"%)"+"<br>Worst performer: "+worstState.name+" ("+pct(worstState.value)+"%)"
            }
            else {
                return (indicObjState[currentYear][id].rank===null)
                ? "Rank: -/"+ranktotal+"<br>Best performer: "+bestState.name+" ("+pct(bestState.value)+"%)"+"<br>Worst performer: "+worstState.name+" ("+pct(worstState.value)+"%)"
                : "Rank: "+indicObjState[currentYear][id].rank+"/"+ranktotal +"<br>Best performer: "+bestState.name+" ("+pct(bestState.value)+"%)"+"<br>Worst performer: "+worstState.name+" ("+pct(worstState.value)+"%)"
            }
        }
    }

    function buildDataTitle(d,i) {
        var id=d.properties.state_id
        if (indicName==='Households worked (lakhs)' || indicName==='Person-days per household worked' || indicName==='Average wage' || indicName==='Person-days per rural household') {
            if (indicObjState[currentYear][id]===undefined) {
                return "<b>"+stateNames[id]+"</b><br>"+"No data"
            }
            else {
                return isNaN(indicObjState[currentYear][id][indicName]) ? "<b>"+stateNames[id]+"</b><br>"+"No data" : "<b>"+stateNames[id]+"</b><br>"+indicName+": "+pct(indicObjState[currentYear][id][indicName]);
            }
        }
        if (indicName==='Percent female person-days' || indicName==='Percent SC person-days' || indicName==='Percent ST person-days' || indicName==='Percent rural households worked') {
            if (indicObjState[currentYear][id]===undefined) {
                return "<b>"+stateNames[id]+"</b><br>"+"No data"
            }
            else {
                return isNaN(indicObjState[currentYear][id][indicName]) ? "<b>"+stateNames[id]+"</b><br>"+"No data" : "<b>"+stateNames[id]+"</b><br>"+indicName+": "+pct(indicObjState[currentYear][id][indicName])+"%";
            }
        }
    }

    d3.select("#dlCSV").on("click", function() {
        var yearStr = currentYear;
        var dlArray = [['state_id','state', 'district_id', 'district', indicName, 'year']];
        var keys1 = Object.keys(indicObjState[currentYear])
        keys1.forEach(function(d, i) {
            dlArray.push([d, stateNames[d], '', '', indicObjState[currentYear][d][indicName], yearStr])
        })
        var keys2 = Object.keys(indicObjDistrict[currentYear])
        keys2.forEach(function(d, i) {
            dlArray.push([indicObjDistrict[currentYear][d]['state_id'], stateNames[indicObjDistrict[currentYear][d]['state_id']], indicObjDistrict[currentYear][d]['district_id_2001'], districtNames[d], indicObjDistrict[currentYear][d][indicName], yearStr])
        })
        var dlString = Arrays2CSVString(dlArray);
        $("#dlCSV").append('<form id="exportform" action="export.php" method="post" target="_blank"><input type="hidden" id="exportdata" name="exportdata" /></form>');
        $("#exportdata").val(dlString);
        $("#exportform").submit().remove();

    });

} // end chart function


function Arrays2CSVString(objArray) {
   var array = objArray;
   var str = '';
   for (var i = 0; i < array.length; i++) {
       var line = '';
       for (var index in array[i]) {
           line += array[i][index] + ',';
       }
       line.slice(0,line.Length-1); 
       str += line + '\r\n';
   }
   return str;
}

d3.select('#dlChart').on('click', function() {
    svgenie.save( "chart1svg", {
        name : "nregamap.png"
    });
});
</script>
